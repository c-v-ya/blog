{"componentChunkName":"component---src-templates-post-template-js","path":"/2021-02-17-elk","result":{"data":{"markdownRemark":{"frontmatter":{"date":"February 17, 2021","title":"Setting Up Local ELK Stack","path":"/2021-02-17-elk","description":"Taming ElasticSearch, Logstash and Kibana","tags":"docker"},"html":"<p><em>Photo by</em> <a href=\"https://unsplash.com/@chanphoto?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\"><em>Chandler Cruttenden</em></a> <em>on</em> <a href=\"https://unsplash.com/?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\"><em>Unsplash</em></a></p>\n<p>As I promised in the <a href=\"https://dev.to/c_v_ya/monitoring-apps-with-docker-containers-1oak\">previous post</a>, here we'll take a look at how to spin up an <a href=\"https://www.elastic.co/what-is/elk-stack\">ELK</a>. Let's go! üöÄ</p>\n<h2>Elastic</h2>\n<p>Straight to the point: open <a href=\"https://www.portainer.io/\">Portainer</a>. Go to \"Containers\" and smash the \"Add container\" button. Then look at the screenshot below and fill values for Name, Image, Ports and Volumes. Maybe change Restart Policy to Unless stopped. One mild difference is that you need to click on \"Advanced mode\" in order to be able to pull an image from Elastic hub. In the screenshot it says \"Simple mode\" since I already chose advanced.</p>\n<p><img src=\"https://raw.githubusercontent.com/c-v-ya/con-con/master/screenshots/Elastic.png\" alt=\"Elastic create container\" title=\"Elastic create container\"></p>\n<p>Then hit the \"Deploy the container\" button and wait a little.</p>\n<p>Almost nothing new, if you've read my first article about <a href=\"https://dev.to/c_v_ya/dockerizing-stuff-you-need-3b7m\">dockerizing stuff you need</a>. You did read that, right? ü§î</p>\n<p>Here I'm not creating any volumes just because. But you most definitely can. Just map it to <code class=\"language-text\">/usr/share/elasticsearch/data</code>.</p>\n<h2>Kibana</h2>\n<p>First create a volume, for example <code class=\"language-text\">kibana_data</code>. Then create container as on the screenshot below:</p>\n<p><img src=\"https://raw.githubusercontent.com/c-v-ya/con-con/master/screenshots/Kibana.png\" alt=\"Kibana create container\" title=\"Kibana create container\"></p>\n<h2>Logstash</h2>\n<p>Man, am I tired to repeat this üòÖ Create volume and compare the stuff you're typing with a screenshot:</p>\n<p><img src=\"https://raw.githubusercontent.com/c-v-ya/con-con/master/screenshots/Logstash.png\" alt=\"alt text\" title=\"Logstash create container\"></p>\n<p>Deploy and wait.</p>\n<p>Next, configuring.</p>\n\n        <deckgo-highlight-code   theme=\"monokai\" >\n          <code slot=\"code\">sudo nano /var/lib/docker/volumes/logstash_data/_data/config/logstash.yml</code>\n        </deckgo-highlight-code>\n      \n<p>Don't know what is this, but it's important:</p>\n\n        <deckgo-highlight-code   theme=\"monokai\" >\n          <code slot=\"code\">http.host: &quot;0.0.0.0&quot;\nxpack.monitoring.elasticsearch.hosts: [ &quot;http://172.17.0.1:9200&quot; ]</code>\n        </deckgo-highlight-code>\n      \n<p>Now pipeline. I have zero explanation why it was necessary to separate main and pipeline configs, but when I was first figuring it out it took me 3 hours of swear, frustration and eye strain. Maybe it's somewhere in documentation but it's buried so good I couldn't find it.</p>\n\n        <deckgo-highlight-code   theme=\"monokai\" >\n          <code slot=\"code\">sudo nano /var/lib/docker/volumes/logstash_data/_data/pipeline/logstash.conf</code>\n        </deckgo-highlight-code>\n      \n<p>I went with this config below since I don't need beat or w/e it is called. I just want to POST logs to Logstash. And you can always configure that as you wish by referencing the <a href=\"https://www.elastic.co/guide/en/logstash/current/configuration-file-structure.html\">official documentation</a>.</p>\n\n        <deckgo-highlight-code   theme=\"monokai\" >\n          <code slot=\"code\">input {\n¬† http {\n¬† ¬† port =&gt; 5044\n¬† }\n}\n\noutput {\n¬† stdout {\n¬† ¬† codec =&gt; json\n¬† }\n¬† elasticsearch {\n¬† ¬† hosts =&gt; [&quot;http://172.17.0.1:9200&quot;]\n¬† ¬† index =&gt; &quot;logstash-%{+YYYY}&quot;\n¬† }\n}</code>\n        </deckgo-highlight-code>\n      \n<p>Now we try this! Simple <code class=\"language-text\">curl -XPUT &#39;http://127.0.0.1:5044/&#39; -d &#39;log&#39;</code> will suffice. Now navigate to <a href=\"http://0.0.0.0:5601/app/management\">http://0.0.0.0:5601/app/management</a>. It's under \"Management\" / \"Stack management\" inside the toast menu. Choose \"Index Management\" below \"Data\" from the side menu. You can see our \"logstash-2021\" index. Or whatever year you live in. That means it has data!</p>\n<p><img src=\"https://raw.githubusercontent.com/c-v-ya/con-con/master/screenshots/Kibana-Index-Management.png\" alt=\"Kibana Index Management\" title=\"Kibana Index Management\"></p>\n<p>Go to <a href=\"http://0.0.0.0:5601/app/discover\">http://0.0.0.0:5601/app/discover</a>. It's \"Kibana\" / \"Discover\" inside the toast menu. And what we'll see? Right, one hit we've just sent!</p>\n<p><img src=\"https://raw.githubusercontent.com/c-v-ya/con-con/master/screenshots/Kibana-Discover.png\" alt=\"Kibana Discover\" title=\"Kibana Discover\"></p>\n<p>Here you can filter everything as you'd like üêß</p>\n<hr>\n<p>Hope you've learned something new from this article. And now you're a master of local deployment with Docker and a help from Portainer! Cheers and happy coding!</p>","timeToRead":3},"file":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAFep1jQICv/xAAaEAACAgMAAAAAAAAAAAAAAAAAAREhAhIx/9oACAEBAAEFAsYYpijWnQ+//8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/AW1//8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8BR//EABsQAAIBBQAAAAAAAAAAAAAAAAABkQIQESIy/9oACAEBAAY/AthuDqmBMxb/xAAbEAEAAwADAQAAAAAAAAAAAAABACExEUFhof/aAAgBAQABPyFWhee5yUz0xTqPeoGw3Ep0Qpr5P//aAAwDAQACAAMAAAAQuO//xAAWEQEBAQAAAAAAAAAAAAAAAAABEQD/2gAIAQMBAT8QrK5Bm//EABgRAQEAAwAAAAAAAAAAAAAAAAEAESEx/9oACAECAQE/EMHIDu//xAAbEAEBAAMBAQEAAAAAAAAAAAABEQAhQTFRcf/aAAgBAQABPxCc8DL6cTFGBESD737rIpP1Xtfvcc3wKfrl3tNXmTUOhx//2Q==","aspectRatio":1.5023474178403755,"src":"/blog/static/7950d3cffaebb5a916a52843313f2ff1/68386/chandler-cruttenden-sDrnyCEAAiI-unsplash.jpg","srcSet":"/blog/static/7950d3cffaebb5a916a52843313f2ff1/474e4/chandler-cruttenden-sDrnyCEAAiI-unsplash.jpg 320w,\n/blog/static/7950d3cffaebb5a916a52843313f2ff1/3bf7d/chandler-cruttenden-sDrnyCEAAiI-unsplash.jpg 640w,\n/blog/static/7950d3cffaebb5a916a52843313f2ff1/68386/chandler-cruttenden-sDrnyCEAAiI-unsplash.jpg 1280w,\n/blog/static/7950d3cffaebb5a916a52843313f2ff1/097fa/chandler-cruttenden-sDrnyCEAAiI-unsplash.jpg 1920w","sizes":"(max-width: 1280px) 100vw, 1280px"}}}},"pageContext":{"imagePath":"chandler-cruttenden-sDrnyCEAAiI-unsplash.jpg","prev":null,"next":{"frontmatter":{"path":"/2021-02-07-monitoring","title":"Monitoring Apps with Docker Containers","date":"February 07, 2021","author":"Constantine Yarushkin","description":"Connecting containers together","image":"ibrahim-boran-iYkqHp5cGQ4-unsplash.jpg","tags":"docker"}}}}}