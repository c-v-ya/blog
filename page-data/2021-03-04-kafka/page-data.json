{"componentChunkName":"component---src-templates-post-template-js","path":"/2021-03-04-kafka","result":{"data":{"markdownRemark":{"frontmatter":{"date":"March 04, 2021","title":"Setting Up Kafka in Docker","path":"/2021-03-04-kafka","description":"It's easier than it looks","tags":"docker, kafka"},"html":"<p><em>Photo by</em> <a href=\"https://unsplash.com/@polarmermaid?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\"><em>Anne NygÃ¥rd</em></a> <em>on</em> <a href=\"https://unsplash.com/s/photos/envelope?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\"><em>Unsplash</em></a></p>\n<p>\"Here we go, another article on setting up some thing in Docker ðŸ˜’\", you might think. This time it's Kafka. And I wouldn't write about it if it was that trivial.</p>\n<p>Thanks to <a href=\"https://github.com/wurstmeister/kafka-docker\">wurstmeister</a>, we have separate docker images for Kafka and Zookeeper. But setting this up <a href=\"https://dev.to/c_v_ya/dockerizing-stuff-you-need-3b7m\">my way</a> without docker compose is a task in and of itself.</p>\n<h1>Zookeper</h1>\n<p>We'll need two volumes for this guy. You know how it goes, go to \"Volumes\" side-menu and smash the \"Add volume\" button. Name the first one <code class=\"language-text\">zookeeper_data</code>, and the second one - <code class=\"language-text\">zookeeper_conf</code>.</p>\n<p>Next go to the \"Containers\" side menu, click the \"Add container\" button. Set:</p>\n<ul>\n<li>name: zookeeper</li>\n<li>image: wurstmeister/zookeeper:latest</li>\n<li>publish port: 2181:2181</li>\n<li>\n<p>add volumes:</p>\n<ul>\n<li>/opt/zookeeper-3.4.13/data to zookeeper_data</li>\n<li>/opt/zookeeper-3.4.13/conf to zookeeper_conf</li>\n</ul>\n</li>\n</ul>\n<p>As always, a handy screenshot for you:\n<img src=\"https://raw.githubusercontent.com/c-v-ya/con-con/master/screenshots/Zookeeper.png\" alt=\"Zookeeper create container\" title=\"Zookeeper create container\"></p>\n<p>Now destroy that \"Deploy the container\" button and wait a little.</p>\n<h1>Kafka</h1>\n<p>This guy will need just one volume. Name it <code class=\"language-text\">kafka_volume</code>. Now pay attention when creating a container. Set:</p>\n<ul>\n<li>name: kafka</li>\n<li>image: wurstmeister/kafka:latest</li>\n<li>publish port: 9092:9092</li>\n<li>\n<p>add volumes:</p>\n<ul>\n<li>/kafka to kafka_data</li>\n<li><strong>bind</strong> /var/run/docker.sock to /var/run/docker.sock</li>\n</ul>\n</li>\n<li>\n<p><strong>env</strong>:</p>\n<ul>\n<li>KAFKA_ADVERTISED_HOST_NAME: 172.17.0.1</li>\n<li>KAFKA_ZOOKEEPER_CONNECT: 172.17.0.1:2181</li>\n<li>ZK: 172.17.0.1:2181</li>\n<li>HOST: 172.17.0.1:9092</li>\n<li>KAFKA_ADVERTISED_PORT: 9092</li>\n</ul>\n</li>\n</ul>\n<p><code class=\"language-text\">ZK</code> and <code class=\"language-text\">HOST</code> envs are just for shortening commands later on.</p>\n<p>Screenshot for sanity check:\n<img src=\"https://raw.githubusercontent.com/c-v-ya/con-con/master/screenshots/Kafka.png\" alt=\"Kafka create container\" title=\"Kafka create container\"></p>\n<p>And deploy.</p>\n<h1>Communicate</h1>\n<p>There is already a <a href=\"https://wurstmeister.github.io/kafka-docker\">guide</a> on how to use this stuff, but there is a mistake in the consuming part.</p>\n<h2>Create topic</h2>\n<p>But let's start with creating a topic. Go to \">_ Console\" of the Kafka container. Or execute command below in your terminal session</p>\n\n        <deckgo-highlight-code   theme=\"monokai\" >\n          <code slot=\"code\">docker exec -it kafka /bin/bash</code>\n        </deckgo-highlight-code>\n      \n<p>Once inside container create topic just as in above mentioned guide:</p>\n\n        <deckgo-highlight-code   theme=\"monokai\" >\n          <code slot=\"code\">kafka-topics.sh --create --topic topic \\\n--partitions 4 --zookeeper $ZK --replication-factor 1\nkafka-topics.sh --describe --topic topic --zookeeper $ZK</code>\n        </deckgo-highlight-code>\n      \n<p>You'll see messages about topic creation and it's description:</p>\n\n        <deckgo-highlight-code   theme=\"monokai\" >\n          <code slot=\"code\">Created topic topic.\n\nTopic: topic PartitionCount: 4 ReplicationFactor: 1 Configs:\nTopic: topic Partition: 0 Leader: 1002 Replicas: 1002 Isr: 1002\nTopic: topic Partition: 1 Leader: 1002 Replicas: 1002 Isr: 1002\nTopic: topic Partition: 2 Leader: 1002 Replicas: 1002 Isr: 1002\nTopic: topic Partition: 3 Leader: 1002 Replicas: 1002 Isr: 1002</code>\n        </deckgo-highlight-code>\n      \n<h2>Consumer</h2>\n<p>The guide says to run this:</p>\n\n        <deckgo-highlight-code   theme=\"monokai\" >\n          <code slot=\"code\">kafka-console-consumer.sh --topic=topic --zookeeper=$ZK</code>\n        </deckgo-highlight-code>\n      \n<p>But if you try to do that you'll get an error about <code class=\"language-text\">zookeeper is not a recognized option</code>.</p>\n<p>So the correct command is this:</p>\n\n        <deckgo-highlight-code   theme=\"monokai\" >\n          <code slot=\"code\">kafka-console-consumer.sh --topic=topic --bootstrap-server=$HOST</code>\n        </deckgo-highlight-code>\n      \n<p>It didn't freeze, it just waits for messages to come.</p>\n<h2>Producer</h2>\n<p>Open another console or terminal session and connect to the kafka container. Execute:</p>\n\n        <deckgo-highlight-code   theme=\"monokai\" >\n          <code slot=\"code\">kafka-console-producer.sh --topic=topic \\\n--broker-list=`broker-list.sh`</code>\n        </deckgo-highlight-code>\n      \n<p>Now you can type some messages here and it'll show in another session where we have a consumer ðŸš€</p>\n<h1>Bonus</h1>\n<p>Inside <a href=\"https://github.com/c-v-ya/con-con/tree/master/flask_app\">kafka_app</a> in the project repo, you'll find two short files with producer and consumer. This is just to show how we can use Kafka in Python:</p>\n\n        <deckgo-highlight-code   theme=\"monokai\" >\n          <code slot=\"code\">python -m venv venv\nsource venv/bin/activate\npip install -r requirements.txt\npython consumer.py</code>\n        </deckgo-highlight-code>\n      \n<p>In another terminal session:</p>\n\n        <deckgo-highlight-code   theme=\"monokai\" >\n          <code slot=\"code\">source venv/bin/activate\npython producer.py</code>\n        </deckgo-highlight-code>\n      \n<p>Now look at the terminal with our python consumer and you'll see a topic, message key and value.</p>\n<p>Also, if you didn't close previous sessions with the console consumer, you'll see the same message there. And publishing from the console producer will deliver a message to both console and python consumers.</p>\n<hr>\n<p>Now you have one more tool in your toolbox! Go use this stuff ðŸ’ª</p>","timeToRead":3},"file":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAIBBAUG/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAVr66S88SH//xAAbEAACAQUAAAAAAAAAAAAAAAABAgADBBAREv/aAAgBAQABBQI2yxqAB1hlBjnp/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAACAwEAAAAAAAAAAAAAAAAAARAhMZH/2gAIAQEABj8C1m1NofD/xAAbEAEAAgIDAAAAAAAAAAAAAAABABEhMUFRYf/aAAgBAQABPyG3E1S9Yih0ziE4GXDQNDon/9oADAMBAAIAAwAAABDj3//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/EKf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAYEAEAAwEAAAAAAAAAAAAAAAABABEhMf/aAAgBAQABPxCgDfmkMrzrcRkVl5Y6Q2K9U8UjPWkJwMCf/9k=","aspectRatio":1.5023474178403755,"src":"/blog/static/7c0cd565198894fc6144d357c881183a/68386/anne-nygard-RaUUoAnVgcA-unsplash.jpg","srcSet":"/blog/static/7c0cd565198894fc6144d357c881183a/474e4/anne-nygard-RaUUoAnVgcA-unsplash.jpg 320w,\n/blog/static/7c0cd565198894fc6144d357c881183a/3bf7d/anne-nygard-RaUUoAnVgcA-unsplash.jpg 640w,\n/blog/static/7c0cd565198894fc6144d357c881183a/68386/anne-nygard-RaUUoAnVgcA-unsplash.jpg 1280w,\n/blog/static/7c0cd565198894fc6144d357c881183a/097fa/anne-nygard-RaUUoAnVgcA-unsplash.jpg 1920w","sizes":"(max-width: 1280px) 100vw, 1280px"}}}},"pageContext":{"imagePath":"anne-nygard-RaUUoAnVgcA-unsplash.jpg","prev":{"frontmatter":{"path":"/2021-03-13-blackd","title":"Black in Docker","date":"March 13, 2021","author":"Constantine Yarushkin","description":"Fromatting Python code remotely with PyCharm","image":"jan-kopriva-Fkt-gbaYJMs-unsplash.jpg","tags":"docker, black"}},"next":{"frontmatter":{"path":"/2021-02-17-elk","title":"Setting Up Local ELK Stack","date":"February 17, 2021","author":"Constantine Yarushkin","description":"Taming ElasticSearch, Logstash and Kibana","image":"chandler-cruttenden-sDrnyCEAAiI-unsplash.jpg","tags":"docker"}}}}}