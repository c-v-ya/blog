{"componentChunkName":"component---src-templates-post-template-js","path":"/2021-03-19-clean-up-docker","result":{"data":{"markdownRemark":{"frontmatter":{"date":"March 19, 2021","title":"Cleaning Up Space after Docker","path":"/2021-03-19-clean-up-docker","description":"Easily free up gigabytes of space!","tags":"docker, logs"},"html":"<p><em>Photo by</em> <a href=\"https://unsplash.com/@wilstewart3?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\"><em>Wil Stewart</em></a> on <a href=\"https://unsplash.com?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\"><em>Unsplash</em></a></p>\n<p>You know how I love Docker and try to move <a href=\"https://dev.to/c_v_ya/setting-up-local-elk-stack-2708\">everything</a> <a href=\"https://dev.to/c_v_ya/setting-up-kafka-in-docker-1e8a\">inside</a> <a href=\"https://dev.to/c_v_ya/black-with-docker-596k\">containers</a>. But a couple days ago I got a system warning that I have about 1Gb left on the root partition. That was a surprise. At the time I was in a Zoom call. And the first thing that came to my mind was \"eh, must be Zoom eating up space\". But in the span of 30 minutes 1Gb turned to 100Mb. So I panicked a little, turned everything off, rebooted and got angry that it was still less than 100Mb on <code class=\"language-text\">/</code>.</p>\n<p>Imagine my amazement when I discovered that <code class=\"language-text\">/var/lib/docker/</code> was eating around 20Gb! What could it be? Turns out it was.. logs! Tons of logs from all the containers I have. And I only have around 10 running daily. Plus 5 more that I spin up when I need them. Such as Elastic, Kafka and Logstash.</p>\n<p>Thankfully, the <a href=\"https://forums.docker.com/t/some-way-to-clean-up-identify-contents-of-var-lib-docker-overlay/30604/40\">solution</a> was quite easy:</p>\n\n        <deckgo-highlight-code   theme=\"monokai\" >\n          <code slot=\"code\">sudo sh -c &quot;truncate -s 0 /var/lib/docker/containers/*/*-json.log&quot;</code>\n        </deckgo-highlight-code>\n      \n<p>This will remove all the logs. That alone freed me 16Gb! My-my...</p>\n<p>But I don't want to run this command with Crontab. Or, even worse, run it manually from time to time. There must be a way to set Docker logging policy, I thought. And there sure is. <a href=\"https://docs.docker.com/config/containers/logging/configure\">Official documentation</a> says how to configure logging and set the max number of files with their size. So, now my <code class=\"language-text\">/etc/docker/daemon.json</code> looks like this:</p>\n\n        <deckgo-highlight-code language=\"json\"  theme=\"monokai\" >\n          <code slot=\"code\">{\n  &quot;log-driver&quot;: &quot;json-file&quot;,\n  &quot;log-opts&quot;: {\n    &quot;max-size&quot;: &quot;100m&quot;,\n    &quot;max-file&quot;: &quot;1&quot;,\n    &quot;env&quot;: &quot;os,customer&quot;\n  }\n}</code>\n        </deckgo-highlight-code>\n      \n<p>Meaning I'll have only one file under 100Mb. Which I think should be suffice for the logs.</p>\n<hr>\n<p>Hope this will save you some time and nerves if/when you'll encounter a similar issue. So you can just focus on writing quality code ðŸ˜Š</p>","timeToRead":2},"file":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAMF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABxqTCCf/EABkQAAIDAQAAAAAAAAAAAAAAAAABEBESIv/aAAgBAQABBQIzyJlx/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhAAAwAAAAAAAAAAAAAAAAAAABEg/9oACAEBAAY/Ahz/AP/EABoQAAIDAQEAAAAAAAAAAAAAAAABESFBMbH/2gAIAQEAAT8hQ2od+FbQ1KCUzqOn/9oADAMBAAIAAwAAABC4L//EABcRAQEBAQAAAAAAAAAAAAAAAAEAEUH/2gAIAQMBAT8QE7Zf/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERUf/aAAgBAgEBPxBrCn//xAAbEAEBAQACAwAAAAAAAAAAAAABEQAhMVFxwf/aAAgBAQABPxAXpX0XCNStPrDymspFDwOUNwOzi5B3f//Z","aspectRatio":1.5023474178403755,"src":"/blog/static/36c7efb21eba8c81625b9124d909176e/68386/wil-stewart-rYWz3Q88P8g-unsplash.jpg","srcSet":"/blog/static/36c7efb21eba8c81625b9124d909176e/474e4/wil-stewart-rYWz3Q88P8g-unsplash.jpg 320w,\n/blog/static/36c7efb21eba8c81625b9124d909176e/3bf7d/wil-stewart-rYWz3Q88P8g-unsplash.jpg 640w,\n/blog/static/36c7efb21eba8c81625b9124d909176e/68386/wil-stewart-rYWz3Q88P8g-unsplash.jpg 1280w,\n/blog/static/36c7efb21eba8c81625b9124d909176e/097fa/wil-stewart-rYWz3Q88P8g-unsplash.jpg 1920w","sizes":"(max-width: 1280px) 100vw, 1280px"}}}},"pageContext":{"imagePath":"wil-stewart-rYWz3Q88P8g-unsplash.jpg","prev":null,"next":{"frontmatter":{"path":"/2021-03-13-blackd","title":"Black in Docker","date":"March 13, 2021","author":"Constantine Yarushkin","description":"Fromatting Python code remotely with PyCharm","image":"jan-kopriva-Fkt-gbaYJMs-unsplash.jpg","tags":"docker, black"}}}}}